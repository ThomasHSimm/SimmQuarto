<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.258">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ThomasHSimm ‚Äì nlp-of-traveltweets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//posts/Picture3.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ThomasHSimm</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ThomasHSimm"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/ThomasHSimm"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><p><img src="../posts/header2.png" height="200"></p>



<section id="natural-language-processing-of-travel-tweets" class="level1">
<h1>Natural Language Processing of Travel Tweets</h1>
<blockquote class="blockquote">
<p>NLP of tweets of travel companies during COVID</p>
</blockquote>
<ul>
<li>toc: true</li>
<li>badges: true</li>
<li>comments: true</li>
<li>categories: [NLP, sentiment analysis, zero shot, twitter, tweepy, Python]</li>
</ul>
<p><img src="ghtop_images/header2.png" class="img-fluid"></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Travel analysis of twitter feeds of UK travel companies TUI and Jet2 twitter accounts before and during the COVID pandemic.</p>
<ul>
<li>Twitter data is obtained from the twitter API using tweepy.</li>
<li>NLP analysis is done using a zero-shot method from transformers.</li>
<li>Analyis of NLP data is kept at a basic level using pandas and matplotlib</li>
</ul>
</section>
<section id="twitter-data" class="level2">
<h2 class="anchored" data-anchor-id="twitter-data">Twitter Data</h2>
<p>Tweets were obtained using the twitter API and tweepy more details on twitter and API <a href="https://thomashsimm.com/twitter/tweepy/python/2022/04/08/Tweepy.html">here- tweepy</a>.</p>
<p>I decided to keep the query simple and just use tweets containing the handle of TUI and Jet2‚Äôs UK twitter accounts, as shown below. This was mainly because of the API limitation meant experimenting on the best query took away from getting data.</p>
<p><code>query='@tuiuk'</code> or <code>query='@jet2tweets'</code></p>
<p>I also decided to get tweets from a 3 day period, at first the start of a month and later in the middle. The tweets were focussed on dates around January 2020 (the start of the pandemic), with data obtained up to ~2 years before this and just over 2 years after this to the present (April 2022). And Use the <code>search_full_archive</code> call from twitter api. Broadly the call is as shown below.</p>
<p><code>from datetime import date</code></p>
<p><code>from datetime import timedelta</code></p>
<p><code>start_time = date.fromisoformat('2020-02-01') end_time = start_time + timedelta(3)</code></p>
<p><code>outa=api.search_full_archive(label="mytwitterlabel",          query=query,toDate=toDate,fromDate=fromDate)</code></p>
<p>This leads to around 1500 tweets per firm at the time of analysis, due to twitter API call being limited.</p>
<p><img src="ghtop_images/hist_notweets.png" class="img-fluid"></p>
<p>The number of tweets for Tui and Jet2 after removing ‚Äòduplicate‚Äô tweets</p>
</section>
<section id="natural-language-processing-nlp" class="level2">
<h2 class="anchored" data-anchor-id="natural-language-processing-nlp">Natural Language Processing (NLP)</h2>
<p>The most ‚Äòreliable‚Äô way to analyse text data is to do a two step process:</p>
<ol type="1">
<li>creating a language model for the data</li>
<li>using this language model with labelled data to classify different texts</li>
</ol>
<p>This method is shown here https://www.kaggle.com/code/thomassimm/imdb-sentiment-analysis for sentiment analysis (i.e.&nbsp;are reviews positive or negative) of IMDB data. But the labels need not be positive or negative but can be more nuanced.</p>
<p>However, for this twitter data there is no labelled data. I could label the data myself but will first try an alternative approach-&gt; the <a href="https://joeddav.github.io/blog/2020/05/29/ZSL.html">zero shot</a> learning method. The advantage is no labelled data is needed nor any prior training. But the accuracy will be reduced without any training as shown below.</p>
<p><img src="https://joeddav.github.io/blog/images/zsl/gpt3_triviahq.png" class="img-fluid"></p>
<p>Another advantage of the method is that it can be used to classify text data by broad labels based on the language model as shown by the example from the link below:</p>
<p><code>sentence = 'Who are you voting for in 2020?'</code></p>
<p><code>labels = ['business', 'art &amp; culture', 'politics']</code></p>
<p>And the similarity for each label (high the better):</p>
<p><code>label: politics     similarity: 0.21561521291732788</code></p>
<p><code>label: business     similarity: 0.004524140153080225</code></p>
<p><code>label: art &amp; culture    similarity: -0.027396833524107933</code></p>
<section id="labels-for-travel-data" class="level3">
<h3 class="anchored" data-anchor-id="labels-for-travel-data">Labels for travel data</h3>
<p>At this point in analysis the goals are broad, I mainly want to know if I can understand how customers were reacting to the travel restriction changes being imposed on them and how this differed for the two travel companies. So what may be things we would want to classify from the tweets:</p>
<ol type="1">
<li>How happy/unhappy are the customers?</li>
<li>Is there a change in the number of what would be classed as complaints?</li>
<li>Can sentiments be separated by what is the cause? e.g.&nbsp;customer service, cancellations, company policies</li>
<li>(similar to above) What do the tweets refer to?</li>
<li>Can we remove customer tweets from spam/promotional details/business changes etc?</li>
</ol>
<p>After a bit of iterating I decided on the following labels (see https://www.kaggle.com/code/thomassimm/travel-tweets-nlp/ for trying out different labels).</p>
<p><code>candidate_labels=['query','complaint',                   'holiday','hotel',                   'flight','flight cancellation','flight delay',                   'website or app problem','customer service',                   'travel regulations','price',                  'holiday cancellation']</code></p>
<p>Let us examine how the labels work for different tweets (picked randomly but avoiding tweets with similarity):</p>
<pre><code>    A) Hi there, do you know the transfer time? I couldn‚Äôt see it on the website. Thanks </code></pre>
<ul>
<li><p>query 0.98</p></li>
<li><p>complaint 0.73<br>
</p></li>
<li><p>holiday 0.00<br>
</p></li>
<li><p>hotel 0.62</p></li>
<li><p>flight 0.24<br>
</p></li>
<li><p>flight cancellation 0.01<br>
</p></li>
<li><p>flight delay 0.15<br>
</p></li>
<li><p>website or app problem 0.89<br>
</p></li>
<li><p>customer service 0.97<br>
</p></li>
<li><p>travel regulations 0.26<br>
</p></li>
<li><p>price 0.00</p></li>
<li><p>holiday cancellation 0.00</p>
<pre><code>  B) Worst ever sent details of complaint Florida villa including memory stick with photos sent in never heard a thing don‚Äôt bother they just ignore you</code></pre></li>
<li><p>query 0.72</p></li>
<li><p>complaint 0.98<br>
</p></li>
<li><p>holiday 0.73<br>
</p></li>
<li><p>hotel 0.03</p></li>
<li><p>flight 0.00<br>
</p></li>
<li><p>flight cancellation 0.00<br>
</p></li>
<li><p>flight delay 0.00<br>
</p></li>
<li><p>website or app problem 0.00<br>
</p></li>
<li><p>customer service 0.82<br>
</p></li>
<li><p>travel regulations 0.06<br>
</p></li>
<li><p>price 0.09</p></li>
<li><p>holiday cancellation 0.13</p>
<pre><code>      C) hi I‚Äôve been trying to book a holiday for a few days on my pc or via the mobile app but when I try to check out I get this error message</code></pre></li>
<li><p>query 0.73</p></li>
<li><p>complaint 0.97<br>
</p></li>
<li><p>holiday 0.94<br>
</p></li>
<li><p>hotel 0.47</p></li>
<li><p>flight 0.17<br>
</p></li>
<li><p>flight cancellation 0.00<br>
</p></li>
<li><p>flight delay 0.00<br>
</p></li>
<li><p>website or app problem 1.00<br>
</p></li>
<li><p>customer service 0.70<br>
</p></li>
<li><p>travel regulations 0.22<br>
</p></li>
<li><p>price 0.07</p></li>
<li><p>holiday cancellation 0.94</p>
<pre><code>      D) how do I amend dates on my holiday. Iv tried ringing customer service but was given wrong number to ring. Thanks </code></pre></li>
<li><p>query 0.91</p></li>
<li><p>complaint 0.93<br>
</p></li>
<li><p>holiday 0.99<br>
</p></li>
<li><p>hotel 0.17</p></li>
<li><p>flight 0.11<br>
</p></li>
<li><p>flight cancellation 0.02<br>
</p></li>
<li><p>flight delay 0.02<br>
</p></li>
<li><p>website or app problem 0.00<br>
</p></li>
<li><p>customer service 0.67<br>
</p></li>
<li><p>travel regulations 0.57<br>
</p></li>
<li><p>price 0.00</p></li>
<li><p>holiday cancellation 0.38</p>
<pre><code>      E) Maybe not quite neighbouring - Trinidad and Tobago üòÅüòÅüòÇ </code></pre></li>
<li><p>query 0.37</p></li>
<li><p>complaint 0.87<br>
</p></li>
<li><p>holiday 0.03<br>
</p></li>
<li><p>hotel 0.03</p></li>
<li><p>flight 0.03<br>
</p></li>
<li><p>flight cancellation 0.01<br>
</p></li>
<li><p>flight delay 0.01<br>
</p></li>
<li><p>website or app problem 0.02<br>
</p></li>
<li><p>customer service 0.06<br>
</p></li>
<li><p>travel regulations 0.08<br>
</p></li>
<li><p>price 0.04</p></li>
<li><p>holiday cancellation 0.06</p></li>
</ul>
<p>Some quick comments:</p>
<ol type="1">
<li>Overall the labels make sense to the particular tweets.</li>
<li>Complaint seems to be high for all even when they are clearly not complaints (D and E). Although, obvious complaints have higher values. Maybe combine with sentiment analysis?</li>
<li>Website and app issues well picked up, preseumably as they use the words website or app</li>
<li>The one with no relevance to customer service (E) scores low for query and customer service, so maybe the metric can help to distinguish these.</li>
<li>Highest value for flight was for A even though flight not explicitly mentioned</li>
</ol>
<p>Lots of positives from this small selection. But to get a good idea of classification may take some more modication in terms of what to use and what values they give for different things. Perhaps this can be done as a neural network after some sort of labelling?</p>
</section>
</section>
<section id="analysis-of-labelled-data" class="level2">
<h2 class="anchored" data-anchor-id="analysis-of-labelled-data">Analysis of Labelled data</h2>
<p>A brief analysis of the NLP results is given here https://www.kaggle.com/code/thomassimm/travel-tweets-analyseresults and presented below.</p>
<p>The most obvious thing to check first is the change in the sentiment of tweets. The figure below does this by taking the average of the positive sentiment for each time period.</p>
<section id="sentiment" class="level4">
<h4 class="anchored" data-anchor-id="sentiment">Sentiment</h4>
<p><img src="ghtop_images/positive_sent.png" class="img-fluid"></p>
<p>Some initial comments:</p>
<ol type="1">
<li>Jet2 gets more positive tweets than Tui</li>
<li>The data may be noisy. The changes before the pandemic are noticeably large and it is not obvious if these are real trends or just noise. More digging would need to be done to establish what the changes are before COVID before the change during COVID could be assessed.</li>
<li>The overall sentiment appears to be at a low in early 2022, the easing of restrictions may be suggesting a more positive sentiment in the future.</li>
<li>Since this is an average of a random selection of tweets. A change in the nature of the tweets would have a big influence on the results.</li>
</ol>
</section>
<section id="customer-service-queries" class="level4">
<h4 class="anchored" data-anchor-id="customer-service-queries">Customer Service Queries</h4>
<p>Given the last of the comments (the nature of the tweets), we may wish to separate tweets based on some overall criteria- e.g.&nbsp;review (inclusing complaint), query and other (including none customer queries, general comments, spam etc). Or remove the last of these by some other criteria such as ‚Äòcustomer service‚Äô and/or ‚Äòquery‚Äô more than a certain amount.</p>
<p><img src="ghtop_images/query_sent.png" class="img-fluid"> <img src="ghtop_images/custserv_sent.png" class="img-fluid"></p>
<p>Based on the above figures the percentage of tweets that are labelled ‚Äòquery‚Äô or ‚Äòcustomer service‚Äô increase sharply during the pandemic. This would make sense given the confusion around the situation and the questions that customers will have around COVID regulations and company policies in dealing with these changes.</p>
</section>
<section id="complaints" class="level4">
<h4 class="anchored" data-anchor-id="complaints">Complaints</h4>
<p>Returning to the overall sentiment figure above, can a classification of tweets based on whether they are a complaint help with the changes?</p>
<p>As shown in the figure below the complaint classification shows a clearer increase during the COVID period. Perhaps this offers a better way instead of the sentiment analysis to understand the nature of the tweets, but more analysis would be required.</p>
<p>The maximum values for this metric for both cmpanies at the end of 2021 / start of 2022, are worth exploring in more detail</p>
<p><img src="ghtop_images/complaint_sent.png" class="img-fluid"></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>